{"hierarchy":{"paths":[["doc:\/\/App\/documentation\/App"]]},"sections":[],"metadata":{"title":"Signing behaviour","roleHeading":"Article","role":"article","modules":[{"name":"App"}]},"kind":"article","identifier":{"url":"doc:\/\/App\/documentation\/App\/SigningBehaviour","interfaceLanguage":"swift"},"abstract":[{"type":"text","text":"Mastodon has extended the ActivityPub objects to include a PublicKey. This is to enable it to sign the requests used to"},{"text":" ","type":"text"},{"text":"distribute status updates out to followers.","type":"text"}],"schemaVersion":{"minor":3,"major":0,"patch":0},"primaryContentSections":[{"kind":"content","content":[{"level":2,"type":"heading","anchor":"overview","text":"Overview"},{"inlineContent":[{"type":"image","identifier":"SigningBehaviourSequence"}],"type":"paragraph"},{"level":2,"type":"heading","anchor":"How-is-the-signature-created","text":"How is the signature created"},{"type":"paragraph","inlineContent":[{"text":"Mastodon selects particular elements from the request and builds a signature for those using the key for the ","type":"text"},{"code":"Person","type":"codeVoice"},{"text":" ","type":"text"},{"text":"(Actor in Mastodon documentation) originating the status.","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"HTTP header looks like: -","type":"text"}]},{"syntax":null,"type":"codeListing","code":["Signature: keyId=\"https:\/\/my.example.com\/actor#main-key\",headers=\"(request-target) host date\",signature=\"Y2FiYW...IxNGRiZDk4ZA==\""]},{"type":"paragraph","inlineContent":[{"text":"The three parts in this signature are:-","type":"text"}]},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"keyId - URL to the public key of the Person","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"headers - The headers used as source data for the signature"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"signature - SH256 hash of the headers which is signed using the private key of the Person and then base64 encoded"}]}]}],"type":"unorderedList"},{"type":"paragraph","inlineContent":[{"type":"text","text":"For POST requests, an additional header is added which is a SHA256 of the request body. This is stored in "},{"type":"codeVoice","code":"Digest"},{"type":"text","text":""},{"type":"text","text":" "},{"type":"text","text":"header which is then included in the signature."}]}]}],"variants":[{"paths":["\/documentation\/app\/signingbehaviour"],"traits":[{"interfaceLanguage":"swift"}]}],"references":{"doc://App/documentation/App":{"url":"\/documentation\/app","title":"App","abstract":[{"text":"Drop in replacement for a mastodon service.","type":"text"}],"type":"topic","role":"collection","kind":"symbol","identifier":"doc:\/\/App\/documentation\/App"},"SigningBehaviourSequence":{"type":"image","identifier":"SigningBehaviourSequence","alt":"A sequence diagram showing the conversation when a Mastodon server commnunicates an activity to another server","variants":[{"traits":["1x","light"],"url":"\/images\/App\/SigningBehaviourSequence.png"}]}}}