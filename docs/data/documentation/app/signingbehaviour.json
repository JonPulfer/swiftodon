{"kind":"article","schemaVersion":{"major":0,"patch":0,"minor":3},"metadata":{"title":"Signing behaviour","roleHeading":"Article","role":"article","modules":[{"name":"App"}]},"sections":[],"identifier":{"url":"doc:\/\/App\/documentation\/App\/SigningBehaviour","interfaceLanguage":"swift"},"abstract":[{"text":"Mastodon has extended the ActivityPub objects to include a PublicKey. This is to enable it to sign the requests used to","type":"text"},{"text":" ","type":"text"},{"text":"distribute status updates out to followers.","type":"text"}],"variants":[{"paths":["\/documentation\/app\/signingbehaviour"],"traits":[{"interfaceLanguage":"swift"}]}],"hierarchy":{"paths":[["doc:\/\/App\/documentation\/App"]]},"primaryContentSections":[{"kind":"content","content":[{"text":"Overview","level":2,"type":"heading","anchor":"overview"},{"inlineContent":[{"type":"image","identifier":"SigningBehaviourSequence"}],"type":"paragraph"},{"text":"How is the signature created","level":2,"type":"heading","anchor":"How-is-the-signature-created"},{"inlineContent":[{"type":"text","text":"Mastodon selects particular elements from the request and builds a signature for those using the key for the "},{"code":"Person","type":"codeVoice"},{"text":" ","type":"text"},{"text":"(Actor in Mastodon documentation) originating the status.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"HTTP header looks like: -","type":"text"}]},{"code":["Signature: keyId=\"https:\/\/my.example.com\/actor#main-key\",headers=\"(request-target) host date\",signature=\"Y2FiYW...IxNGRiZDk4ZA==\""],"type":"codeListing","syntax":null},{"type":"paragraph","inlineContent":[{"text":"The three parts in this signature are:-","type":"text"}]},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"keyId - URL to the public key of the Person"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"headers - The headers used as source data for the signature"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"signature - SH256 hash of the headers which is signed using the private key of the Person and then base64 encoded"}]}]}],"type":"unorderedList"},{"type":"paragraph","inlineContent":[{"text":"For POST requests, an additional header is added which is a SHA256 of the request body. This is stored in ","type":"text"},{"type":"codeVoice","code":"Digest"},{"text":"","type":"text"},{"text":" ","type":"text"},{"text":"header which is then included in the signature.","type":"text"}]}]}],"references":{"doc://App/documentation/App":{"kind":"symbol","url":"\/documentation\/app","abstract":[{"text":"Drop in replacement for a mastodon service.","type":"text"}],"type":"topic","title":"App","identifier":"doc:\/\/App\/documentation\/App","role":"collection"},"SigningBehaviourSequence":{"identifier":"SigningBehaviourSequence","variants":[{"url":"\/images\/App\/SigningBehaviourSequence.png","traits":["1x","light"]}],"type":"image","alt":"A sequence diagram showing the conversation when a Mastodon server commnunicates an activity to another server"}}}