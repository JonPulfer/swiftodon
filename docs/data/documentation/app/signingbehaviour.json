{"schemaVersion":{"major":0,"patch":0,"minor":3},"metadata":{"role":"article","title":"Signing behaviour","modules":[{"name":"App"}],"roleHeading":"Article"},"hierarchy":{"paths":[["doc:\/\/App\/documentation\/App"]]},"sections":[],"abstract":[{"text":"Mastodon has extended the ActivityPub objects to include a PublicKey. This is to enable it to sign the requests used to","type":"text"},{"text":" ","type":"text"},{"text":"distribute status updates out to followers.","type":"text"}],"primaryContentSections":[{"content":[{"type":"heading","text":"Overview","level":2,"anchor":"overview"},{"type":"paragraph","inlineContent":[{"identifier":"SigningBehaviourSequence","type":"image"}]},{"type":"heading","text":"How is the signature created","level":2,"anchor":"How-is-the-signature-created"},{"type":"paragraph","inlineContent":[{"text":"Mastodon selects particular elements from the request and builds a signature for those using the key for the ","type":"text"},{"code":"Person","type":"codeVoice"},{"text":" ","type":"text"},{"text":"(Actor in Mastodon documentation) originating the status.","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"HTTP header looks like: -","type":"text"}]},{"type":"codeListing","code":["Signature: keyId=\"https:\/\/my.example.com\/actor#main-key\",headers=\"(request-target) host date\",signature=\"Y2FiYW...IxNGRiZDk4ZA==\""],"syntax":null},{"type":"paragraph","inlineContent":[{"type":"text","text":"The three parts in this signature are:-"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"keyId - URL to the public key of the Person"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"headers - The headers used as source data for the signature","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"signature - SH256 hash of the headers which is signed using the private key of the Person and then base64 encoded","type":"text"}],"type":"paragraph"}]}]},{"type":"paragraph","inlineContent":[{"text":"For POST requests, an additional header is added which is a SHA256 of the request body. This is stored in ","type":"text"},{"code":"Digest","type":"codeVoice"},{"text":"","type":"text"},{"text":" ","type":"text"},{"text":"header which is then included in the signature.","type":"text"}]}],"kind":"content"}],"variants":[{"paths":["\/documentation\/app\/signingbehaviour"],"traits":[{"interfaceLanguage":"swift"}]}],"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/App\/documentation\/App\/SigningBehaviour"},"kind":"article","references":{"SigningBehaviourSequence":{"type":"image","alt":"A sequence diagram showing the conversation when a Mastodon server commnunicates an activity to another server","identifier":"SigningBehaviourSequence","variants":[{"url":"\/images\/App\/SigningBehaviourSequence.png","traits":["1x","light"]}]},"doc://App/documentation/App":{"role":"collection","identifier":"doc:\/\/App\/documentation\/App","kind":"symbol","title":"App","abstract":[{"type":"text","text":"Drop in replacement for a mastodon service."}],"url":"\/documentation\/app","type":"topic"}}}