{"schemaVersion":{"major":0,"patch":0,"minor":3},"hierarchy":{"paths":[["doc:\/\/App\/documentation\/App"]]},"kind":"article","identifier":{"interfaceLanguage":"swift","url":"doc:\/\/App\/documentation\/App\/SigningBehaviour"},"abstract":[{"text":"Mastodon has extended the ActivityPub objects to include a PublicKey. This is to enable it to sign the requests used to","type":"text"},{"text":" ","type":"text"},{"text":"distribute status updates out to followers.","type":"text"}],"primaryContentSections":[{"kind":"content","content":[{"text":"Overview","type":"heading","anchor":"overview","level":2},{"type":"paragraph","inlineContent":[{"identifier":"SigningBehaviourSequence","type":"image"}]},{"text":"How is the signature created","type":"heading","anchor":"How-is-the-signature-created","level":2},{"type":"paragraph","inlineContent":[{"text":"Mastodon selects particular elements from the request and builds a signature for those using the key for the ","type":"text"},{"code":"Person","type":"codeVoice"},{"text":" ","type":"text"},{"text":"(Actor in Mastodon documentation) originating the status.","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"HTTP header looks like: -","type":"text"}]},{"type":"codeListing","code":["Signature: keyId=\"https:\/\/my.example.com\/actor#main-key\",headers=\"(request-target) host date\",signature=\"Y2FiYW...IxNGRiZDk4ZA==\""],"syntax":null},{"type":"paragraph","inlineContent":[{"text":"The three parts in this signature are:-","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"keyId - URL to the public key of the Person"}]}]},{"content":[{"inlineContent":[{"text":"headers - The headers used as source data for the signature","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"signature - SH256 hash of the headers which is signed using the private key of the Person and then base64 encoded"}]}]}]},{"type":"paragraph","inlineContent":[{"text":"For POST requests, an additional header is added which is a SHA256 of the request body. This is stored in ","type":"text"},{"code":"Digest","type":"codeVoice"},{"text":"","type":"text"},{"text":" ","type":"text"},{"text":"header which is then included in the signature.","type":"text"}]}]}],"sections":[],"metadata":{"title":"Signing behaviour","modules":[{"name":"App"}],"role":"article","roleHeading":"Article"},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/app\/signingbehaviour"]}],"references":{"doc://App/documentation/App":{"title":"App","role":"collection","type":"topic","kind":"symbol","url":"\/documentation\/app","abstract":[{"type":"text","text":"Drop in replacement for a mastodon service."}],"identifier":"doc:\/\/App\/documentation\/App"},"SigningBehaviourSequence":{"type":"image","identifier":"SigningBehaviourSequence","variants":[{"traits":["1x","light"],"url":"\/images\/App\/SigningBehaviourSequence.png"}],"alt":"A sequence diagram showing the conversation when a Mastodon server commnunicates an activity to another server"}}}